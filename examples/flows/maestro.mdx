---
inputs:
  objective:
    message: Describe what you would like me to do
    type: text
---

Intro

---

<Loop
  as="l"
  until={$self[$self.length - 1].taskResult.startsWith('TASK COMPLETE:')}
  inject={{ objective }}>

  Based on the following objective, and the previous sub-task results (if any), please break down the objective into the next sub-task, and create a concise and detailed prompt for a subagent so it can execute that task.

  IMPORTANT!!! when dealing with code tasks make sure you check the code for errors and provide fixes and support as part of the next sub-task. If you find any bugs or have suggestions for better code, please include them in the next sub-task prompt.

  Please assess if the objective has been fully achieved. If the previous sub-task results comprehensively address all aspects of the objective, include the phrase "TASK COMPLETE:" at the beginning of your response. If the objective is not yet fully achieved, break it down into the next sub-task and create a concise and detailed prompt for a subagent to execute that task.:

  Objective: {objective}

  Previous sub-task results:
  - {//$self.length ? $self.map(l => l.taskResult).join('\n- ') : 'None'}

  <GenerateText as="taskPrompt" model="ollama::llama3.1" />

  ---

  Previous tasks:
  {//$self.length ? $self.map(l => `Task: ${l.taskPrompt}\nResult: ${l.taskResult}`).join('\n') : 'None'}

  {taskPrompt}

  <GenerateText as="taskResult" model="ollama::llama3.1" />
</Loop>

---

Objective: {objective}

Sub-task results:
- {$loop.map(l => l.taskResult).join('\n- ')}

Please review and refine the sub-task results into a cohesive final output. Add any missing information or details as needed.

<GenerateText as="final" model="ollama::llama3.1" />
